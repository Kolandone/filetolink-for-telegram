# filetolink-for-telegram

---
این پروژه یک ربات تلگرامی است که فایل‌های ارسالی در چت "Saved Messages" را دریافت کرده، پس از تأیید کاربر دانلود می‌کند، به Google Drive آپلود می‌کند و لینک دانلود تولید می‌کند. فایل‌ها پس از 30 دقیقه به‌صورت خودکار از Google Drive حذف می‌شوند.

## ویژگی‌ها
- پشتیبانی از تمام فرمت‌های فایل تا 2 گیگابایت (ویدئو، صوت، سند و غیره).
- تأیید دو مرحله‌ای: تأیید دانلود و تأیید آپلود.
- پاک‌سازی خودکار فایل‌ها از Google Drive پس از 30 دقیقه.
- استفاده از دایرکتوری موقت برای ذخیره فایل‌ها.

## پیش‌نیازها

### نرم‌افزارها و کتابخانه‌ها
- **Python 3.x** (ترجیحاً 3.7 یا بالاتر)

- **کتابخانه‌های Python**:
  - نصب با دستور زیر:
    ```
    pip install telethon google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client
    ```
- **دسترسی به Google Drive**:
  - یک فایل `service-account.json` از [Google Cloud Console](https://console.cloud.google.com/) دریافت کنید.
- **دسترسی به API تلگرام**:
  - `api_id` و `api_hash` از [my.telegram.org](https://my.telegram.org/) دریافت کنید.

### فایل‌های مورد نیاز
- `set.py`: کد اصلی ربات.
- `run_bot.sh`: اسکریپت برای اجرای خودکار ربات.
- `service-account.json`: کلید احراز هویت Google Drive.

### تنظیمات سرور
- دایرکتوری موقت (`temp`) باید قابل نوشتن باشد.
- فایل‌های لاگ و PID باید دسترسی مناسب داشته باشند.

## نصب

1. **دانلود پروژه**:
   - کد را از مخزن GitHub کلون کنید یا فایل‌ها را دستی آپلود کنید:
     ```
     git clone https://github.com/Kolandone/filetolink-for-telegram.git
     cd filetolink-for-telegram
     ```

2. **نصب پیش‌نیازها**:
   - کتابخانه‌ها را نصب کنید:
     ```
     pip install telethon google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client
     ```


3. **تنظیم فایل‌ها**:
   - **`set.py`**:
     - `api_id`، `api_hash`، `phone`، `PARENT_FOLDER_ID` و `MY_USER_ID` را با اطلاعات خود جایگزین کنید.
     - فایل `service-account.json` را در دایرکتوری پروژه قرار دهید.
   - **`run_bot.sh`**:
     - مسیرها (مثل `/usr/home/account`) را با دایرکتوری حساب کاربری خود جایگزین کنید.
     - دسترسی اجرایی به اسکریپت بدهید:
       ```
       chmod +x set.py
       ```

4. **تنظیم دسترسی‌ها**:
   - دایرکتوری موقت را ایجاد و دسترسی دهید:
     ```
     mkdir temp
     chmod 755 temp
     ```
   - دسترسی فایل‌ها را تنظیم کنید:
     ```
     chmod 644 bot.log
     ```

## اجرا

1. **اجرا دستی**:
   - برای تست اولیه، ربات را به‌صورت دستی اجرا کنید:
     ```
     python set.py
     ```

2. **اجرا خودکار**:
   - اسکریپت `run_bot.sh` را برای اجرای خودکار تنظیم کنید:
     ```
     chmod +x run_bot.sh
     ```
   - کرون‌جاب را برای اجرای هر 3 دقیقه تنظیم کنید:
     ```
     crontab -e
     ```
     - خط زیر را اضافه کنید:
       ```
       */3 * * * * /usr/home/account/run_bot.sh
       ```

## نحوه استفاده
1. ربات را با ارسال `/start` در چت "Saved Messages" فعال کنید.
2. یک فایل ارسال کنید (تا 2 گیگابایت).
3. ربات ابتدا می‌پرسد: "آیا می‌خواهید این فایل دانلود شود؟" ("بله" یا "خیر").
   - اگر "بله"، دانلود شروع می‌شود و سپس می‌پرسد: "آیا لینک این فایل را می‌خواهید؟".
   - اگر "خیر"، عملیات لغو می‌شود.
4. پس از تأیید آپلود، لینک دانلود دریافت می‌کنید.
5. فایل‌ها پس از 30 دقیقه از Google Drive حذف می‌شوند.

## عیب‌یابی
- **خطای عدم اتصال**:
  - مطمئن شوید `api_id`، `api_hash` و `phone` درست وارد شده‌اند.
- **خطای Google Drive**:
  - بررسی کنید `service-account.json` معتبر است و `PARENT_FOLDER_ID` درست تنظیم شده است.
- **کمبود حافظه**:
  - با `free -m` حافظه را چک کنید. فایل‌های موقت را حذف کنید: `rm -f temp/*`.
- **مشاهده لاگ‌ها**:
  - لاگ‌ها در `bot.log` ذخیره می‌شوند. برای بررسی:
    ```
    cat bot.log
    ```

## نکات
- فایل‌های ارسالی باید زیر 2 گیگابایت باشند.
- برای سرورهای با RAM کم (مثل 512 مگابایت)، از ارسال فایل‌های بزرگ خودداری کنید.

## لینک‌های مفید
- [Google Drive](https://drive.google.com/)
- [Google Cloud Console](https://console.cloud.google.com/)
- [Telegram API](https://my.telegram.org/)


